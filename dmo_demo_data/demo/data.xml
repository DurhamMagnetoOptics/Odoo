<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
    <!-- Locations -->
        <record id="stock_location_GoodsIn" model="stock.location">
            <field name="name">Goods In</field>
            <field name="location_id" model="stock.location"
                eval="obj().env.ref('stock.warehouse0').view_location_id.id"/>
        </record>          
        <record id="stock_location_Stores" model="stock.location">
            <field name="name">Stores</field>
            <field name="putaway_savespace">True</field>
            <field name="location_id" model="stock.location"
                eval="obj().env.ref('stock.warehouse0').view_location_id.id"/>
        </record>          
        <record id="stock_location_Vertical1" model="stock.location">
            <field name="name">Vertical 1</field>
            <field name="location_id" ref="stock_location_Stores"/>
        </record>  
        <record id="stock_location_Builds" model="stock.location">
            <field name="name">Builds</field>
            <field name="location_id" model="stock.location"
                eval="obj().env.ref('stock.warehouse0').view_location_id.id"/>
        </record>          
        <record id="stock_location_HUST" model="stock.location">
            <field name="name">HUST</field>
            <field name="location_id" ref="stock_location_Builds"/>
        </record>   

        <!-- Route -->
        <record id="stock_location_route_ComponentResupply" model="stock.location.route">
            <field name="name">Component Resupply</field>
            <field name="product_selectable">True</field>
        </record>

        <!-- Products-->
        <record id="product_product_MW3" model="product.product">
            <field name="name">MW3</field>
            <field name="categ_id" ref="product.product_category_5"/>
            <field name="standard_price">290</field>
            <field name="list_price">520</field>
            <field name="type">product</field>
            <field name="weight">0.01</field>
            <field name="uom_id" ref="uom.product_uom_unit"/>
            <field name="uom_po_id" ref="uom.product_uom_unit"/>
            <field name="description">MicroWriter 3</field>
            <field name="default_code">DMO_MW3</field>
        </record> 

        <record id="product_product_CompA" model="product.product">
            <field name="name">CompA</field>
            <field name="categ_id" ref="product.product_category_5"/>
            <field name="standard_price">2.50</field>
            <field name="list_price">2.50</field>
            <field name="type">product</field>
            <field name="weight">0.01</field>
            <field name="uom_id" ref="uom.product_uom_unit"/>
            <field name="uom_po_id" ref="uom.product_uom_unit"/>
            <field name="description">Machined Component</field>
            <field name="default_code">PL-12345</field>
            <field name="route_ids" eval="[(6, 0, [ref('stock_location_route_ComponentResupply')])]"/>            
        </record>    


        <!-- Rules -->
        <record id="stock_location_rule_ResupplyInPlace" model="stock.rule">
            <field name="name">Resupply In Place</field>
            <field name="action">pull</field>
            <field name="picking_type_id" model="stock.picking.type"
                eval="obj().env.ref('stock.warehouse0').int_type_id.id"/>
            <field name="location_src_id" ref="stock_location_GoodsIn"/>
            <field name="location_id" ref="stock_location_Builds"/>   
            <field name="procure_method">make_to_order</field>
            <field name="route_id" ref="stock_location_route_ComponentResupply"/>
            <field name="sequence">10</field>               
        </record>          
        <record id="stock_location_rule_KitFromStores" model="stock.rule">
            <field name="name">Kit from Stores</field>
            <field name="action">pull</field>
            <field name="picking_type_id" model="stock.picking.type"
                eval="obj().env.ref('stock.warehouse0').int_type_id.id"/>
            <field name="location_src_id" ref="stock_location_Stores"/>
            <field name="location_id" ref="stock_location_Builds"/>   
            <field name="procure_method">mts_else_alt</field>
            <field name="alternate_rule_id" ref="stock_location_rule_ResupplyInPlace"/>
            <field name="route_id" ref="stock_location_route_ComponentResupply"/>
            <field name="sequence">5</field>               
        </record>               
        <record id="stock_location_rule_ResupplyStores" model="stock.rule">
            <field name="name">Resupply Stores</field>
            <field name="action">pull</field>
            <field name="picking_type_id" model="stock.picking.type"
                eval="obj().env.ref('stock.warehouse0').int_type_id.id"/>
            <field name="location_src_id" ref="stock_location_GoodsIn"/>
            <field name="location_id" ref="stock_location_Stores"/>   
            <field name="procure_method">make_to_order</field>
            <field name="route_id" ref="stock_location_route_ComponentResupply"/>   
            <field name="sequence">15</field>              
        </record>    
        <record id="stock_location_rule_PutawayLeftovers" model="stock.rule">
            <field name="name">Putaway Leftovers</field>
            <field name="action">push</field>
            <field name="picking_type_id" model="stock.picking.type"
                eval="obj().env.ref('stock.warehouse0').int_type_id.id"/>
            <field name="location_src_id" ref="stock_location_GoodsIn"/>
            <field name="location_id" ref="stock_location_Stores"/>   
            <field name="auto">manual</field>
            <field name="route_id" ref="stock_location_route_ComponentResupply"/>   
            <field name="sequence">20</field>              
        </record>              
        <record id="stock_location_rule_TriggerPO" model="stock.rule">
            <field name="name">Trigger PO</field>
            <field name="action">buy</field>
            <field name="picking_type_id" model="stock.picking.type"
                eval="obj().env.ref('stock.warehouse0').in_type_id.id"/> 
            <field name="location_id" ref="stock_location_GoodsIn"/>   
            <field name="route_id" ref="stock_location_route_ComponentResupply"/>   
            <field name="group_propagation_option">none</field>
            <field name="sequence">25</field>              
        </record>          
        <record id="stock_location_rule_MTOKitting" model="stock.rule">
            <field name="name">Kit on Demand</field>
            <field name="action">pull</field>
            <field name="picking_type_id" model="stock.picking.type"
                eval="obj().env.ref('stock.warehouse0').manu_type_id.id"/>
            <field name="location_src_id" ref="stock_location_Builds"/>   
            <field name="location_id" model="product.template"
                eval="obj().env.ref('dmo_demo_data.product_product_CompA').property_stock_production.id"/>                 
            <field name="procure_method">make_to_order</field>
            <field name="route_id" ref="stock_location_route_ComponentResupply"/>   
            <field name="sequence">30</field>              
        </record>                      
     

        <!-- Supplier -->       
        <record id="product_supplierinfo_CompA" model="product.supplierinfo">
            <field name="product_tmpl_id" model="product.template"
                eval="obj().env.ref('dmo_demo_data.product_product_CompA').product_tmpl_id.id"/> 
            <field name="name" ref="base.res_partner_12"/>
            <field name="delay">1</field>
            <field name="min_qty">10.0</field>
            <field name="increment_qty">5.0</field>
            <field name="round_up">True</field>
            <field name="price">2.50</field>
        </record>       

        <!-- Resource: stock.inventory.line -->
        <record id="stock_inventory_CompA" model="stock.inventory">
            <field name="name">Starting CompA Inventory</field>
        </record>

        <record id="stock_inventory_line_CompA" model="stock.inventory.line">
            <field name="product_id" ref="product_product_CompA"/>
            <field name="product_uom_id" ref="uom.product_uom_unit"/>
            <field name="inventory_id" ref="stock_inventory_CompA"/>
            <field name="product_qty">2.0</field>
            <field name="location_id" ref="stock_location_Vertical1"/>
        </record>  

        <function model="stock.inventory" name="_action_start">
            <function eval="[[('state','=','draft'),('id', '=', ref('stock_inventory_CompA'))]]" model="stock.inventory" name="search"/>
        </function>
        <function model="stock.inventory" name="action_validate">
            <function eval="[[('state','=','confirm'),('id', '=', ref('stock_inventory_CompA'))]]" model="stock.inventory" name="search"/>
        </function>        


        <!-- BOM -->
        <record id="mrp_bom_MW3" model="mrp.bom">
            <field name="product_tmpl_id" model="product.template"
                eval="obj().env.ref('dmo_demo_data.product_product_MW3').product_tmpl_id.id"/>      
            <field name="product_uom_id" ref="uom.product_uom_unit"/>
        </record>
        <record id="mrp_bom_manufacture_line_1" model="mrp.bom.line">
            <field name="product_id" ref="product_product_CompA"/>
            <field name="product_qty">3</field>
            <field name="product_uom_id" ref="uom.product_uom_unit"/>
            <field name="sequence">5</field>
            <field name="bom_id" ref="mrp_bom_MW3"/>
        </record> 

        <!-- create xml id for manufacturing operation, for more convenience -->
        <function model="ir.model.data" name="_update_xmlids">
            <value model="base" eval="[{
                'xml_id': 'dmo_demo_data.picking_type_manu',
                'record': obj().env.ref('stock.warehouse0').manu_type_id
            }]"/>
        </function>   

        <!-- Settings -->
        <record id="my_config_settings" model="res.config.settings">
            <field name="group_stock_multi_locations" eval="True"/>
            <field name="group_stock_adv_location" eval="True"/>
        </record>
        <function model="res.config.settings" name="execute">
            <value model="res.config.settings"
                search="[('id', '=', ref('my_config_settings'))]"/>
        </function>     

        <!-- Receipts go to goods in by default (like receipt in 2 steps) -->
        <!-- Turn on push leftovers for receipts -->        
        <record id="stock.picking_type_in" model="stock.picking.type">
            <field name="default_location_dest_id" ref="stock_location_GoodsIn"/>
            <field name="push_leftover">True</field>
        </record>  

        <!-- Turn on apply_parent for manufacturing -->
        <record id="dmo_demo_data.picking_type_manu" model="stock.picking.type">
            <field name="apply_parent_pull">True</field>
        </record>                    
    </data>
</odoo> 